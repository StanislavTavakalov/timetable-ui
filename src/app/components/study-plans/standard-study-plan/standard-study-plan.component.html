<mat-spinner *ngIf="isLoading;else mainContent" diameter="150" mode="indeterminate" color="primary" class="spinner">
</mat-spinner>

<ng-template #mainContent>
  <div class="main-content" *ngIf="standardPlan" class="column">
    <h1 style="font-size: 30px; margin-left: 1%"> Типовой план </h1>
    <div class="row" style="font-size: 16px">
      <div><b> Специализация: </b>  {{standardPlan.speciality.shortName}} </div>
      <div style="margin-left: 2%"><b> Квалификация: </b>   {{standardPlan.qualification.name}} </div>
      <div style="margin-left: 2%"><b> Форма
        обучения:</b>    {{resourceLocalizer.localizeEducationForm(standardPlan.educationForm)}}</div>

    </div>

    <div class="row" style="font-size: 16px">
      <div><b> Количество семестров: </b> {{standardPlan.semestersCount}} </div>
      <div style="margin-left: 2%"><b> Год разработки: </b> {{standardPlan.developmentYear}} </div>
      <div style="margin-left: 2%"><b> Статус:</b>  {{resourceLocalizer.localizeStudyPlanStatus(standardPlan.status)}}
      </div>
      <div style="margin-left: 2%"><b> Дата изменения статуса:</b>  {{standardPlan.statusChangeDate | date:'medium'}}
      </div>
    </div>
    <div class="row" style="font-size: 16px">
      <div><b>Дата создания: </b>   {{standardPlan.createdWhen | date: 'medium'}} </div>
      <div style="margin-left: 2%"><b>Дата изменения: </b>   {{standardPlan.updatedWhen | date: 'medium'}} </div>
    </div>



    <div>
      <mat-accordion multi>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title style="font-size: 16px">
              Требования к графику образовательного процесса
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div>
            <table mat-table [dataSource]="activityDataSource" style="width: 50%">


              <!-- Activity Column -->
              <ng-container matColumnDef="activity">
                <th mat-header-cell *matHeaderCellDef> Вид деятельности</th>
                <td mat-cell *matCellDef="let activity"> {{activity.activity.name}} </td>
              </ng-container>

              <!-- Week Count Column -->
              <ng-container matColumnDef="weekCount">
                <th mat-header-cell *matHeaderCellDef> Количество семестров</th>
                <td mat-cell *matCellDef="let activity"> {{activity.totalWeekCount}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="activityColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: activityColumns;"></tr>
            </table>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title style="font-size: 16px">
              Требования к структуре плана
            </mat-panel-title>
          </mat-expansion-panel-header>
          <table #cyclesTable mat-table class="cycle-table" [dataSource]="cyclesDataSource" matSort
                 multiTemplateDataRows>

            <ng-container matColumnDef="position">
              <th mat-header-cell *matHeaderCellDef> №</th>
              <td mat-cell *matCellDef="let cycle">
                {{cycle.position}}.
              </td>
              <td mat-footer-cell *matFooterCellDef> Итого:</td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef> Название</th>
              <td mat-cell *matCellDef="let cycle">
                {{cycle.name}}
              </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <ng-container matColumnDef="totalHours">
              <th mat-header-cell *matHeaderCellDef> Всего часов</th>
              <td mat-cell *matCellDef="let cycle"
                  [ngStyle]="{'color': this.studyPlanUtilService.selectValidTotalHoursTextColor(cycle) }">
                {{cycle.totalHours}}
              </td>
              <td mat-footer-cell
                  *matFooterCellDef> {{this.studyPlanUtilService.calculateTotalHours(this.cyclesDataSource.data)}} </td>
            </ng-container>

            <ng-container matColumnDef="classroomHours">
              <th mat-header-cell *matHeaderCellDef> Аудиторных</th>
              <td mat-cell *matCellDef="let cycle"
                  [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                {{cycle.classroomHours}}
              </td>
              <td mat-footer-cell
                  *matFooterCellDef> {{this.studyPlanUtilService.calculateClassroomHours(this.cyclesDataSource.data)}} </td>
            </ng-container>

            <ng-container matColumnDef="selfHours">
              <th mat-header-cell *matHeaderCellDef> Самостоятельных</th>
              <td mat-cell *matCellDef="let cycle"
                  [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                {{cycle.totalHours - cycle.classroomHours}}
              </td>
              <td mat-footer-cell
                  *matFooterCellDef> {{this.studyPlanUtilService.calculateSelfHours(this.cyclesDataSource.data)}} </td>
            </ng-container>

            <ng-container matColumnDef="creditUnits">
              <th mat-header-cell *matHeaderCellDef> Зачетных единиц</th>
              <td mat-cell *matCellDef="let cycle"
                  [ngStyle]="{'color': this.studyPlanUtilService.selectValidCreditUnitHoursTextColor(cycle) }">
                {{cycle.creditUnits}}
              </td>
              <td mat-footer-cell
                  *matFooterCellDef> {{this.studyPlanUtilService.calculateCreditUnits(this.cyclesDataSource.data)}} </td>
            </ng-container>


            <!--  COMPONENTS START  -->
            <ng-container matColumnDef="component-table-details">
              <td mat-cell *matCellDef="let cycle" [attr.colspan]="this.displayedCycleColumns.length"
                  style="padding: 0 !important;">
                <div class="example-element-detail">
                  <table #componentsTable mat-table class="component-table"
                         [dataSource]="createDataSource(cycle.components)" matSort
                         multiTemplateDataRows *ngIf="cycle.components && cycle.components.length !== 0">

                    <ng-container matColumnDef="position-component">
                      <th mat-header-cell *matHeaderCellDef> №</th>
                      <td mat-cell *matCellDef="let component"></td>
                    </ng-container>

                    <ng-container matColumnDef="name-component">
                      <th mat-header-cell *matHeaderCellDef> Название</th>
                      <td mat-cell *matCellDef="let component">
                        {{component.name}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="totalHours-component">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let component"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidTotalHoursTextColor(cycle) }">
                        {{component.totalHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="classroomHours-component">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let component"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                        {{component.classroomHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="selfHours-component">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let component"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                        {{component.totalHours - component.classroomHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="creditUnits-component">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let component"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidCreditUnitHoursTextColor(cycle) }">
                        {{component.creditUnits}}
                      </td>
                    </ng-container>

                    <!--  COMPONENT DISCIPLINES TABLE START  -->
                    <ng-container matColumnDef="discipline-component-table-details">
                      <td mat-cell *matCellDef="let component" [attr.colspan]="this.displayedComponentsColumns.length"
                          style="padding: 0 !important;">
                        <div class="example-element-detail">
                          <div *ngIf="component.disciplines && component.disciplines.length !== 0">

                            <table #componentDisciplinesTable mat-table class="component-table"
                                   [dataSource]="createDataSource(component.disciplines)" matSort
                                   multiTemplateDataRows
                                   *ngIf="component.disciplines && component.disciplines.length !== 0">

                              <ng-container matColumnDef="position-discipline">
                                <th mat-header-cell *matHeaderCellDef> №</th>
                                <td mat-cell *matCellDef="let discipline"> {{cycle.position}}
                                  .{{discipline.position}}</td>
                              </ng-container>

                              <ng-container matColumnDef="name-discipline">
                                <th mat-header-cell *matHeaderCellDef> Название</th>
                                <td mat-cell *matCellDef="let discipline">
                                  {{discipline.name}}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="totalHours-discipline">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let discipline"
                                    [ngStyle]="{'color': this.studyPlanUtilService.selectValidTotalHoursTextColor(cycle) }">
                                  {{discipline.totalHours}}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="classroomHours-discipline">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let discipline"
                                    [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                                  {{discipline.classroomHours}}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="selfHours-discipline">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let discipline"
                                    [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                                  {{discipline.totalHours - discipline.classroomHours}}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="creditUnits-discipline">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let discipline"
                                    [ngStyle]="{'color': this.studyPlanUtilService.selectValidCreditUnitHoursTextColor(cycle) }">
                                  {{discipline.creditUnits}}
                                </td>
                              </ng-container>

                              <!--                  <tr mat-header-row *matHeaderRowDef="displayedComponentsColumns"></tr>-->
                              <tr mat-row *matRowDef="let component; columns: displayedDisciplineColumns;"
                                  class="example-element-row">
                              </tr>
                            </table>
                          </div>
                        </div>
                      </td>
                    </ng-container>
                    <!--  COMPONENT DISCIPLINES TABLE END  -->
                    <!--                  <tr mat-header-row *matHeaderRowDef="displayedComponentsColumns"></tr>-->
                    <tr mat-row *matRowDef="let component; columns: displayedComponentsColumns;"
                        class="example-element-row">
                    </tr>
                    <tr mat-row *matRowDef="let component; columns: ['discipline-component-table-details']"
                        class="example-detail-row"></tr>
                  </table>

                </div>
              </td>
            </ng-container>
            <!-- COMPONENTS END -->


            <!-- CYCLES DISCIPLINES TABLE START -->
            <ng-container matColumnDef="disciplines-table-details-cycle">
              <td mat-cell *matCellDef="let cycle" [attr.colspan]="this.displayedCycleColumns.length"
                  style="padding: 0 !important;">
                <div class="example-element-detail" *ngIf="cycle.disciplines && cycle.disciplines.length !== 0">
                  <table #cycleDisciplinesTable mat-table class="component-table"
                         [dataSource]="createDataSource(cycle.disciplines)" matSort
                         multiTemplateDataRows *ngIf="cycle.disciplines && cycle.disciplines.length !== 0">

                    <ng-container matColumnDef="position-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline">
                        {{cycle.position}}.{{discipline.position}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="name-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline">
                        {{discipline.name}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="totalHours-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidTotalHoursTextColor(cycle) }">
                        {{discipline.totalHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="classroomHours-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                        {{discipline.classroomHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="selfHours-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidClassroomHoursTextColor(cycle) }">
                        {{discipline.totalHours - discipline.classroomHours}}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="creditUnits-cycle-discipline">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let discipline"
                          [ngStyle]="{'color': this.studyPlanUtilService.selectValidCreditUnitHoursTextColor(cycle) }">
                        {{discipline.creditUnits}}
                      </td>
                    </ng-container>

                    <!--                  <tr mat-header-row *matHeaderRowDef="displayedCycleDisciplineColumns"></tr>-->
                    <tr mat-row *matRowDef="let discipline; columns: displayedCycleDisciplineColumns;"
                        class="example-element-row">
                    </tr>
                  </table>
                </div>
              </td>
            </ng-container>

            <!-- CYCLES DISCIPLINES TABLE END -->


            <tr mat-header-row *matHeaderRowDef="displayedCycleColumns"></tr>
            <tr mat-row *matRowDef="let cycle; columns: displayedCycleColumns;"
                class="example-element-row">
            </tr>

            <!--          <tr mat-row *matRowDef="let cycle; columns: ['icons']" class="example-element-row"  [class.example-expanded-row]="expandedCycle === cycle"></tr>-->
            <tr mat-row *matRowDef="let cycle; columns: ['component-table-details']" class="example-detail-row"></tr>
            <tr mat-row *matRowDef="let cycle; columns: ['disciplines-table-details-cycle']"
                class="example-detail-row"></tr>
            <tr mat-footer-row *matFooterRowDef="displayedCycleColumns"></tr>

          </table>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>

  <div class="row">
    <button mat-raised-button (click)="editPlan()" *ngIf="isInDevelopmentStatus()"> Редактировать</button>
    <button mat-raised-button style="margin-left: 1%" (click)="validateHoursInPlan()"> Проверить часы</button>
    <button mat-raised-button style="margin-left: 1%" (click)="submitStudyPlan()" *ngIf="isInDevelopmentStatus()">
      Утвердить
    </button>
    <button mat-raised-button style="margin-left: 1%" (click)="goBack()"> Вернуться к планам</button>
  </div>
</ng-template>
