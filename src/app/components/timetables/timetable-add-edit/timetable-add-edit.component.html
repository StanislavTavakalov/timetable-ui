<div class="row" *ngIf="timetable">
  <div class="col-md-6 text-right" style="text-align: center; width: 100%">
    <h3 style="font-size: 24px"> {{timetableTitle}} </h3>
  </div>
</div>

<!--<ng-template-->
<!--  #weekViewHourSegmentTemplate-->
<!--  let-segment="segment"-->
<!--  let-locale="locale"-->
<!--  let-segmentHeight="segmentHeight"-->
<!--  let-isTimeLabel="isTimeLabel">-->
<!--  <div-->
<!--    #segmentElement-->
<!--    class="cal-hour-segment"-->
<!--    [style.height.px]="segmentHeight"-->
<!--    [class.cal-hour-start]="segment.isStart"-->
<!--    [class.cal-after-hour-start]="!segment.isStart"-->
<!--    [ngClass]="segment.cssClass">-->
<!--    <div class="cal-time" *ngIf="isTimeLabel">-->
<!--      {{ segment.date | calendarDate:'weekViewHour':locale }}-->
<!--    </div>-->
<!--  </div>-->
<!--</ng-template>-->


<!-- Customer header template. Only week day rendering -->
<ng-template
  #headerTemplate
  let-days="days"
  let-locale="locale"
  let-dayHeaderClicked="dayHeaderClicked"
  let-eventDropped="eventDropped"
  let-trackByWeekDayHeaderDate="trackByWeekDayHeaderDate"
  let-dragEnter="dragEnter"
>
  <div class="cal-day-headers" role="row">
    <div
      class="cal-header"
      style="padding: 10px"
      *ngFor="let day of days; trackBy: trackByWeekDayHeaderDate"
      [class.cal-past]="day.isPast"
      [class.cal-today]="day.isToday"
      [class.cal-future]="day.isFuture"
      [class.cal-weekend]="day.isWeekend"
      [ngClass]="day.cssClass"
      (mwlClick)="dayHeaderClicked.emit({ day: day, sourceEvent: $event })"
      mwlDroppable
      dragOverClass="cal-drag-over"
      (drop)="
            eventDropped.emit({
              event: $event.dropData.event,
              newStart: day.date
            })
          "
      (dragEnter)="dragEnter.emit({ date: day.date })"
      tabindex="0"
      role="columnheader">
      <b style="font-size: 18px;">{{ day.date | calendarDate: 'weekViewColumnHeader':locale }}</b
      ><br/>
    </div>
  </div>
</ng-template>


<div style="display: flex; flex-direction: row">
  <div style="width: 70%;">
    <mwl-calendar-week-view
      [viewDate]="viewDate"
      [events]="events"
      [dayStartHour]="8"
      [dayEndHour]="22"
      [excludeDays]="[0]"
      [hourSegmentHeight]="65"
      [weekStartsOn]="1"
      [refresh]="refresh"
      [headerTemplate]="headerTemplate"
      [eventTemplate]="eventTemplateCustom"
      (eventClicked)="onEventClicked($event)"
      (hourSegmentClicked)="onSegmentClick($event)">
    </mwl-calendar-week-view>
  </div>


  <ng-template
    #eventTemplateCustom
    let-weekEvent="weekEvent"
    let-eventClicked="eventClicked">
    <div
      class="cal-event"
      style="box-shadow: 5px 5px 5px rgba(187,187,187,0.25); overflow: auto; "
      [style.background]="weekEvent.event.meta.onceInTwoWeek? 'repeating-linear-gradient(-45deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)  1px,'
       + weekEvent.event.color?.primary + ' 2px,' +  weekEvent.event.color?.primary + ' 15px)': weekEvent.event.color?.primary"
      [style.border-color]="weekEvent.event.color?.secondary"
      (mwlClick)="eventClicked.emit({
                    event: weekEvent.event,
                    sourceEvent: weekEvent.event
                  })">
      <mwl-calendar-event-actions
        [event]="weekEvent.event">
      </mwl-calendar-event-actions>
      &ngsp;
      <mwl-calendar-event-title
        [event]="weekEvent.event"
        [style.color]="weekEvent.event.color?.secondary"
        [style.font-size]="'15px'"
        [customTemplate]="eventTemplate"
        view="week">
      </mwl-calendar-event-title>
    </div>
  </ng-template>

  <ng-template #eventTemplate let-event="event">
    <div class="column">
      <div>
        {{event.meta.discipline.name}}
      </div>
      <div>
        {{printerService.resourceLocalizerService.localizedLessonType(event.meta.lessonType)}}
      </div>
      <div class="row">
        к.: {{event.meta.building.number}}&nbsp;
        <div>
          ауд.: {{event.meta.classroom.number}}
        </div>
      </div>

      <div>
        Преподаватель: {{event.meta.teacher.firstName}} {{event.meta.teacher.lastName}}
      </div>

      <div *ngIf="event.meta.groups || event.meta.subgrops">
        Группы:
        <div *ngIf="event.meta.groups">
          <div *ngFor="let gr of event.meta.groups">
            {{gr.number}}
          </div>
        </div>

        <div *ngIf="event.meta.subgroups">
          <div *ngFor="let gr of event.meta.subgroups">
            {{getGroupNumberBySubId(gr.id)}}-{{gr.number}}
          </div>
        </div>
      </div>

    </div>
  </ng-template>


  <div style="width: 30%; background-color: white; margin-left: 10px">
<!--    <div style="margin-top: 50px">Список общих дисциплин</div>-->
<!--    <div *ngFor="let disc of commonDisciplinesForLesson">-->
<!--      1. {{disc.name}}-->
<!--    </div>-->

<!--    <div style="margin-top: 50px"></div>-->
<!--    <div *ngFor="let group of timetable.groupsToStudyPlans; let i = index">-->
<!--      <div style="margin-top: 50px"> Учебный план: {{printerService.printStudyPlanName(group.studyPlan)}} </div>-->
<!--      <div style="margin-top: 10px"> {{group.group.number}} кол-во уч: {{group.group.studentCount}} </div>-->
<!--      <div *ngFor="let subgroup of group.group.subgroups; let sub_i = index" style="margin-left: 10px">-->
<!--        {{sub_i + 1}}. {{group.group.number}}-{{subgroup.number}} кол-во уч: {{subgroup.studentCount}} чел.-->
<!--      </div>-->
<!--    </div>-->

    <div *ngFor="let s2g of studyPlanToGroupsOrSubgroups | keyvalue; let i = index" style="margin-top: 2%">
      {{printerService.printStudyPlanNameShort(s2g.key)}}
      Доступно недель для распределения: {{this.studyPlanId2TotalClassroomWeeksInSemester.get(s2g.key.id)}}
      <div *ngFor="let discipline of getDisciplinesForStudyPlan(s2g.key.id)"  style="margin-top: 2%">
        {{discipline.name}} (к распределению:
        {{getTotalHoursByPlan(discipline)}}ч.)
        <div *ngFor="let g of s2g.value">
          {{printerParentGroupNumberIfSubgroup(g.id)}}-{{g.number}} : Распределено {{this.calculatedDistributedHoursForDiscipline(s2g.key.id, g.id, discipline.id)}}ч.
        </div>
      </div>
    </div>


  </div>


</div>
<div>
  <button mat-raised-button> Сохранить</button>
  <button mat-raised-button> Отменить</button>
</div>
